<div class="newToDoContainer">
  <button (click)="openMobileFeedbackForm()" class="mobileFeedbackBtn">Feedback ?</button>
  <div class="titleCont top">
    <input type="text" placeholder="Your {{listType}} list" #title />
    <app-date-picker #picker (selectedDate)="date($event)"></app-date-picker>
    <button (click)="addTitle(title.value, listType); title.value = ''; picker.resetDate()">Create list</button>
  </div>

  <div class="overlay" *ngIf="errorStatus">
    <div class="errorMsg" [ngClass]="{'deleteSuccessMsg': deleteSuccess}">
      <span class="closeModal" (click)="errorStatus = false"></span>
      <h4><span *ngIf="!deleteSuccess">âš ï¸</span><span *ngIf="deleteSuccess" class="textGreen">âœ“</span> {{ errorMsg }}</h4>
    </div>
  </div>

  <app-recent [todoCount]="todoMasterList.length" [expenseCount]="expenseMasterList.length" [todoTitles]="todoTitles"
    [expenseTitles]="expenseTitles" [type]="listType"></app-recent>

    <app-feedback [showMobileFeedbackForm]="showMobileFeedbackForm"></app-feedback>

  <!--------------------------------------- START: TODO --------------------------------------->
  <ng-container *ngIf="listType == 'todo'">
    <div class="toDoCont" *ngFor="let list of todoMasterList; let i = index">
      <div class="titleOpt">
        <h1>{{ list.title }}<br /><span>{{ list.date | date : "dd/MM/yyyy" }}</span></h1>
        <div class="options">
          <button class="move" (click)="moveUp(i, 'todo')" title="move list up"
            [ngClass]="{ 'opacity-50': i === 0 }">â˜ğŸ½</button>
          <button class="move" (click)="moveDown(i, 'todo')" title="move list down"
            [ngClass]="{ 'opacity-50': i === (todoMasterList.length - 1) }">ğŸ‘‡ğŸ½</button>
          <button class="delete" (click)="list.getConfirmation = true" title="delete list">ğŸ—‘ï¸</button>
          <ng-container *ngIf="list.getConfirmation">
            <div class="overlay">
              <div class="confirmation">
                <span class="closeModal" (click)="list.getConfirmation = false"></span>
                <h4>Are you sure you want to delete <span class="bold">{{ list.title }}</span> list?</h4>
                <div>
                  <button class="cancelBtn" (click)="list.getConfirmation = false"> Cancel</button>
                  <button class="confirmBtn" (click)="deleteList(i)">Confirm</button>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="top">
        <input type="text" placeholder="Your todo" #todo />
        <select name="priority" #priority>
          <option value="Priority" disabled selected>Priority â—¢</option>
          <option value="High">High</option>
          <option value="Medium">Medium</option>
          <option value="Low">Low</option>
        </select>
        <button (click)="addTodo(i, todo.value, priority.value); todo.value = ''; priority.value = 'Priority'">+
          Task</button>
      </div>

      <div class="bottom">
        <div class="todoList" *ngFor="let todo of list.tasks; let j = index">
          <h3 [ngClass]="{done : todo.done}">{{ j + 1 }}.</h3>
          <div class="todoItem">
            <span *ngIf="todo.done" class="doneBadge">Done</span>
            <ng-container *ngIf="todo.isUpdate; then elseBlock; else thenBlock"></ng-container>
            <ng-template #thenBlock>
              <div>
                <h3 [ngClass]="{done : todo.done}">{{ todo.todo }}</h3>
              </div>
              <h6 [ngClass]="{red: todo.pri === 'High', green: todo.pri === 'Medium', orange: todo.pri === 'Low', done : todo.done}">{{
                todo.pri }}</h6>
            </ng-template>
            <ng-template #elseBlock>
              <textarea [value]="todo.todo" [(ngModel)]="todo.todo" #updateTodo #ta class="editInput"
                spellcheck="false" (input)="autoResize(ta)" (focus)="autoResize(ta)" (blur)="autoResize(ta)" autofocus></textarea>
                <h6 [ngClass]="{red: todo.pri === 'High', green: todo.pri === 'Medium', orange: todo.pri === 'Low'}">{{
                  todo.pri }}</h6>
            </ng-template>
          </div>

          <div class="todoOpt">
              <input type="checkbox" name="markAsDone" id="markAsDone" class="markAsDone" title="mark as done" (input)="markAsDone(i, j)" [(ngModel)]="todo.done"  [ngClass]="{disable : todo.isUpdate}">
              <span class="editTodo" (click)="todo.isUpdate = true; enterEditMode()" title="edit todo" *ngIf="!todo.isUpdate" [ngClass]="{disable : todo.done}">âœï¸</span>
              <span class="editTodo" (click)="saveTodo(i, j, todo.todo, todo.pri)" title="save todo"
                *ngIf="todo.isUpdate">ğŸ“</span>

            <button (click)="todo.getConfirmation = true" title="delete todo" class="deleteBtn">ğŸ—‘ï¸</button>
            <ng-container *ngIf="todo.getConfirmation">
              <div class="overlay">
                <div class="confirmation">
                  <span class="closeModal" (click)="todo.getConfirmation = false"></span>
                  <h4>Are you sure you want to delete <span class="bold">{{todo.todo | slice:0:20}}</span> task from <span class="bold">{{list.title | slice:0:20}}</span> list?</h4>
                  <div>
                    <button class="cancelBtn" (click)="todo.getConfirmation = false">Cancel</button>
                    <button class="confirmBtn" (click)="deleteTodo(i, j)">Confirm</button>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
  <!--------------------------------------- END: TODO --------------------------------------->


  <!--------------------------------------- START: EXPENSE --------------------------------------->
  <ng-container *ngIf="listType == 'expense'">
    <div class="toDoCont" *ngFor="let list of expenseMasterList; let i = index">
      <div class="titleOpt mobileFlexColumn">
        <h1>{{ list.title }}<br class="removeBr" /><span>{{ list.date | date : "dd/MM/yyyy" }}</span></h1>
        <div class="options">
          <div>
            <ng-container *ngIf="!list.maxExpenseEditable">
              <input type="number" placeholder="Set max. amount" #maxExpenseAmount class="maxExpenseAmount" [value]="list.maxExpenseAmount"/>
              <button class="resetMaxExpense" (click)="setMaxExpense(i, 0)">âœ•</button>
              <button class="setMaxExpense" (click)="setMaxExpense(i, maxExpenseAmount.value)">âœ“</button>
            </ng-container>
            <ng-container *ngIf="list.maxExpenseEditable">
              <p class="maxExpenseAmount maxExpenseAmountP">Max. amount: â‚¹{{ list.maxExpenseAmount | number:'1.0-0':'en-IN' }}</p>
              <button class="resetMaxExpense" (click)="setMaxExpense(i, 0)">âœ•</button>
              <button class="setMaxExpense maxExpenseAmountP" (click)="list.maxExpenseEditable = false">âœï¸</button>
            </ng-container>
          </div>
          <div>
            <button class="move" (click)="moveUp(i, 'expense')" title="move list up"
              [ngClass]="{ 'opacity-50': i === 0 }">â˜ğŸ½</button>
            <button class="move" (click)="moveDown(i, 'expense')" title="move list down"
              [ngClass]="{ 'opacity-50': i === (expenseMasterList.length - 1) }">ğŸ‘‡ğŸ½</button>
            <button class="delete" (click)="list.getConfirmation = true" title="delete list">ğŸ—‘ï¸</button>
          </div>
          <ng-container *ngIf="list.getConfirmation">
            <div class="overlay">
              <div class="confirmation">
                <span class="closeModal" (click)="list.getConfirmation = false"></span>
                <h4>Are you sure you want to delete <span class="bold">{{ list.title }}</span> list?</h4>
                <div>
                  <button class="cancelBtn" (click)="list.getConfirmation = false"> Cancel</button>
                  <button class="confirmBtn" (click)="deleteList(i)">Confirm</button>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="top">
        <input type="text" placeholder="Your expense" #expense />
        <input type="number" placeholder="Amount" #expenseAmount class="expenseAmountInput" />
        <button (click)="addTodo(i, expense.value, expenseAmount.value); expense.value = ''; expenseAmount.value = ''">+ Expense</button>
      </div>

      <div class="bottom">
        <div class="todoList" *ngFor="let expense of list.expenses; let j = index">
          <span *ngIf="expense.done" class="doneBadge">Saving</span>
          <h3>{{ j + 1 }}.</h3>
          <div class="todoItem">

            <ng-container *ngIf="expense.isUpdate; then elseBlock; else thenBlock"></ng-container>
            <ng-template #thenBlock>
              <div class="expenseRow">
                <h3>{{ expense.expense }}</h3>
                <h6 class="expenseAmountInRow" [ngClass]="{savingAmount : expense.done}">&#8377;{{ expense.expenseAmount | number:'1.0-0':'en-IN' }}</h6>

              </div>
            </ng-template>
            <ng-template #elseBlock>
              <div class="expenseRow">
                <textarea #ta [value]="expense.expense" [(ngModel)]="expense.expense" class="editInput"
                  spellcheck="false" (input)="autoResize(ta)" (focus)="autoResize(ta)" (blur)="autoResize(ta)" autofocus></textarea>
                <span>â‚¹</span>&nbsp;
                <input type="number" [value]="expense.expenseAmount" [(ngModel)]="expense.expenseAmount"
                  class="expenseAmountEditInput" />
              </div>
            </ng-template>
          </div>

          <div class="todoOpt">
            <p class="globalDate desktopDate">{{ expense.date ? (expense.date | date:'dd/MM/yy') : '' }}</p>
            <p class="globalDate mobileDate">{{ expense.date ? (expense.date | date:'dd/MM') : '' }}</p>
            <input type="checkbox" name="markAsDone" id="markAsDone" class="markAsDone" title="mark as saving, this expense will be excluded from total expense" (input)="markAsDone(i, j)" [(ngModel)]="expense.done" [ngClass]="{disable : expense.isUpdate}">
            <span class="editTodo" (click)="expense.isUpdate = true; enterEditMode()" title="edit expense"
              *ngIf="!expense.isUpdate">âœï¸</span>
            <span class="editTodo" (click)="saveTodo(i, j, expense.expense, expense.expenseAmount)" title="save expense"
              *ngIf="expense.isUpdate">ğŸ“</span>

            <button (click)="expense.getConfirmation = true" title="delete expense" class="deleteBtn">ğŸ—‘ï¸</button>
            <ng-container *ngIf="expense.getConfirmation">
              <div class="overlay">
                <div class="confirmation">
                  <span class="closeModal" (click)="expense.getConfirmation = false"></span>
                  <h4>Are you sure you want to delete <span class="bold">{{expense.expense | slice:0:20}}</span> expense from <span class="bold">{{list.title | slice:0:20}}</span> list?</h4>
                  <div>
                    <button class="cancelBtn" (click)="expense.getConfirmation = false">Cancel</button>
                    <button class="confirmBtn" (click)="deleteTodo(i, j)">Confirm</button>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
        <div class="totalExpense">
          <h3>Total Expense: </h3>
          <h3 [ngClass]="{'maxAmountWarning': calculateTotalExpense(list) > list.maxExpenseAmount}">&#8377;{{ calculateTotalExpense(list) | number:'1.0-0':'en-IN' }}
            <br>
              <span class="maxAmountWarningMsg maxAmountWarningMsgDesktop" *ngIf="calculateTotalExpense(list) > list.maxExpenseAmount">You have exceeded the maximum expense limit of
                â‚¹{{ list.maxExpenseAmount | number:'1.0-0':'en-IN' }}.</span>
          </h3>
        </div>
        <span class="maxAmountWarningMsg maxAmountWarningMsgMobile" *ngIf="calculateTotalExpense(list) > list.maxExpenseAmount">You have exceeded the
          maximum expense limit of
          â‚¹{{ list.maxExpenseAmount | number:'1.0-0':'en-IN' }}.</span>
      </div>
    </div>
  </ng-container>
  <!--------------------------------------- END: EXPENSE --------------------------------------->
  <footer>
    <p>Built with passion by <a href="https://vishal-two.vercel.app" target="_blank">Vishal<span>â†—</span></a></p>
  </footer>
</div>